blueprint:
  name: GrowBot automatic humidity control 
  description: >
    Die Datei auto_humidity.yaml ist Teil des GrowBot Open Source-Projekts und dient zur automatischen Steuerung der Luftfeuchtigkeit in Ihrer Grow-Umgebung. Sie enthält ein Blueprint für eine Home Assistant-Automation, die Sensoren für die aktuelle Luftfeuchtigkeit, minimale, ziel- und maximale Luftfeuchtigkeitswerte sowie den aktuellen Wachstumsstadium verwendet, um die Luftfeuchtigkeit optimal zu steuern.
    

    Sie können die Datei auto_humidity.yaml auf GitHub einsehen und herunterladen.
    
    
    Das GrowBot Open Source-Projekt ist ein gemeinnütziges Projekt, das sich auf die Bereitstellung von Open-Source-Software für die Automatisierung von Pflanzenwachstumsprozessen konzentriert. Wenn Sie das Projekt unterstützen möchten, können Sie eine finanzielle Spende leisten. Ihre Unterstützung hilft dem Projekt, weiter zu wachsen und den Quellcode kostenlos zur Verfügung zu stellen. Jede Spende, egal wie klein, ist sehr geschätzt und hilft uns, unsere Mission fortzusetzen. Vielen Dank für Ihre Unterstützung!
  domain: automation
  author: GrowBot Open Source
  input:
    humidity_sensor:
      name: Feuchtigkeitssensor
      description: Der Sensor für die aktuelle Luftfeuchtigkeit
      selector:
        entity:
          include_entities:
          # Add your humidity sensor entities here
            - sensor.airmonitoring_grow_humidity
    humidity_trigger_low:
      name: Min-Temperatur Trigger
      description: Der Trigger für die minimale Luftfeuchtigkeit
      selector:
        entity:
          domain: binary_sensor
          include_entities:
          # Add your humidity min trigger entities here
            - binary_sensor.humidity_low_seed
            - binary_sensor.humidity_low_veg
            - binary_sensor.humidity_low_flower
            - binary_sensor.humidity_low_dry 
    humidity_trigger_target:
      name: Ziel-Temperatur Trigger
      description: Der Trigger für die Ziel-Luftfeuchtigkeit
      selector:
        entity:
          domain: binary_sensor     
          include_entities:
        # Add your humidity target trigger entities here
            - binary_sensor.humidity_good_seed
            - binary_sensor.humidity_good_veg
            - binary_sensor.humidity_good_flower
            - binary_sensor.humidity_good_dry 
    humidity_trigger_high:
      name: Max-Temperatur Trigger
      description: Der Trigger für die maximale Luftfeuchtigkeit
      selector:
        entity:
          domain: binary_sensor
          include_entities:
          # Add your humidity max trigger entities here
            - binary_sensor.humidity_high_seed
            - binary_sensor.humidity_high_veg
            - binary_sensor.humidity_high_flower
            - binary_sensor.humidity_high_dry 
    grow_stage_inputselector:
      name: Pflanzenstadiums Auswahl
      description: Der Input-Selektor für das Wachstumsstadium
      selector:
        entity:
          include_entities:
          # Add your grow stage input selector entities here
            - input_select.plant1_stage
    grow_stage_value:
      name: Pflanzenstadiums Wert
      description: Der Wert für das Wachstumsstadium
      selector:
        select:
          options:
          # Add your grow stage values here
            - Seed
            - Veg
            - Flower
            - Dry
          mode: dropdown
    target_script_humidifier_on:
      name: Luftbefeuchter Skript zum Einschalten
      description: Das Skript, das den Luftbefeuchter steuert
      selector:
        entity:
          include_entities:
          # Add your humidifier script entities here
            - script.device_control_humidifier_on
    target_script_humidifier_off:
      name: Luftbefeuchter Skript zum Ausschalten
      description: Das Skript, das den Luftbefeuchter steuert
      selector:
        entity:
          include_entities:
          # Add your humidifier script entities here
            - script.device_control_humidifier_off
    target_script_dehumidifier_on:
      name: Luftentfeuchter Skript zum Einschalten
      description: Das Skript, das den Luftentfeuchter steuert
      selector:
        entity:
          include_entities:
          # Add your dehumidifier script entities here
            - script.device_control_airflowfan_on
    target_script_dehumidifier_off:
      name: Luftentfeuchter Skript zum Ausschalten
      description: Das Skript, das den Luftentfeuchter steuert
      selector:
        entity:
          include_entities:
          # Add your dehumidifier script entities here
            - script.device_control_airflowfan_off


mode: single

trigger:
  - platform: state
    entity_id: !input humidity_trigger_high
    from: "off"
    to: "on"
    id: "high"
  - platform: state
    entity_id: !input humidity_trigger_low
    from: "off"
    to: "on"
  - platform: state
    entity_id: !input humidity_trigger_target
    from: "off"
    to: "on"
    id: "good"

condition:
  - condition: state
    entity_id: !input grow_stage_inputselector
    state: !input grow_stage_value
action:
  - if:
      - condition: trigger
        id:
          - "low"
    then:
      - service: !input target_script_humidifier_on
        data:
          state: true
  - if:
      - condition: trigger
        id:
          - "high"
    then:
      - service: !input target_script_dehumidifier_on
        data:
          state: true
  - if:
      - condition: trigger
        id:
          - "good"
    then:
      - service: !input target_script_humidifier_off
        data:
          state: false
      - service: !input target_script_dehumidifier_off
        data:
          state: false
